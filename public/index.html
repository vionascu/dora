<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>R&D Metrics Report</title>
  <link rel="stylesheet" href="report.css">
</head>
<body>
  <!-- Sidebar Navigation -->
  <aside class="sidebar">
    <div class="sidebar-header">
      <h3>Navigation</h3>
    </div>

    <div class="sidebar-section">
      <h4>Project Filter</h4>
      <div class="project-selector">
        <button class="project-btn active" data-project="all">All Projects</button>
        <div id="project-list"></div>
      </div>
    </div>

    <div class="sidebar-section">
      <h4>Date Range</h4>
      <div class="date-filters">
        <label>From:</label>
        <input type="date" id="date-from" class="date-input">
        <label>To:</label>
        <input type="date" id="date-to" class="date-input">
        <button class="filter-btn" id="apply-date-filter">Apply Filter</button>
        <button class="filter-btn secondary" id="reset-date-filter">Reset</button>
      </div>
    </div>
  </aside>

  <div class="report">
    <!-- Header -->
    <header class="report-header">
      <div class="report-title">
        <h1>R&D Metrics Report</h1>
        <p class="report-subtitle">Validated Analysis of Development Activity</p>
        <p class="report-date" id="report-date"></p>
        <p class="validation-badge" id="validation-badge"></p>
      </div>
    </header>

    <!-- Main Content -->
    <main class="report-content">

      <!-- Key Findings -->
      <section class="section">
        <h2>Key Findings</h2>
        <div class="findings-grid">
          <div class="finding-card">
            <div class="finding-label">Total Development Activity</div>
            <div class="finding-value" id="finding-commits">—</div>
            <div class="finding-description">Commits across all repositories</div>
          </div>
          <div class="finding-card">
            <div class="finding-label">Organization Size</div>
            <div class="finding-value" id="finding-repos">—</div>
            <div class="finding-description">Active repositories</div>
          </div>
          <div class="finding-card">
            <div class="finding-label">Team Size</div>
            <div class="finding-value" id="finding-contributors">—</div>
            <div class="finding-description">Unique contributors</div>
          </div>
          <div class="finding-card">
            <div class="finding-label">Development Velocity</div>
            <div class="finding-value" id="finding-velocity">—</div>
            <div class="finding-description">Average commits per day</div>
          </div>
          <div class="finding-card">
            <div class="finding-label">Test Files</div>
            <div class="finding-value" id="finding-tests">—</div>
            <div class="finding-description">Total test files in projects</div>
          </div>
          <div class="finding-card">
            <div class="finding-label">Epics Documented</div>
            <div class="finding-value" id="finding-epics">—</div>
            <div class="finding-description">Epic stories found across repos</div>
          </div>
          <div class="finding-card">
            <div class="finding-label">User Stories</div>
            <div class="finding-value" id="finding-stories">—</div>
            <div class="finding-description">User stories identified</div>
          </div>
        </div>
      </section>

      <!-- Repository Breakdown -->
      <section class="section">
        <h2>Repository Analysis</h2>
        <div class="repos-container" id="repos-container">
          <p style="color: #999;">Loading repository data...</p>
        </div>
      </section>

      <!-- Data Quality & Validation -->
      <section class="section">
        <h2>Data Quality & Validation</h2>
        <div class="validation-section">
          <div class="validation-item">
            <span class="validation-check">✓</span>
            <div>
              <strong>No Approximations</strong>
              <p>All values are calculated from source data. No "~", "approx", or "estimated" markers found.</p>
            </div>
          </div>
          <div class="validation-item">
            <span class="validation-check">✓</span>
            <div>
              <strong>Required Fields Present</strong>
              <p>All metrics include metric_id, inputs, method, and calculated_at timestamp.</p>
            </div>
          </div>
          <div class="validation-item">
            <span class="validation-check">✓</span>
            <div>
              <strong>Data Bounds Valid</strong>
              <p>No negative values. Coverage values ≤ 100%. All numeric values within expected ranges.</p>
            </div>
          </div>
          <div class="validation-item">
            <span class="validation-check">✓</span>
            <div>
              <strong>Traceable to Source</strong>
              <p>Each metric references raw input files (git_artifacts/ or ci_artifacts/). See manifest.json for full trace.</p>
            </div>
          </div>
        </div>
      </section>

      <!-- Missing Data -->
      <section class="section">
        <h2>Data Completeness</h2>
        <div class="completeness-box">
          <h3>What We Have:</h3>
          <ul class="completeness-list">
            <li>Git commit history for all 3 repositories</li>
            <li>Contributor counts</li>
            <li>Activity velocity (commits/day)</li>
            <li>Lead time between commits</li>
          </ul>

          <h3>What's Not Available (N/A):</h3>
          <ul class="completeness-list">
            <li><strong>Test Coverage</strong> - Requires local test execution (jacoco, lcov, pytest-cov)</li>
            <li><strong>Change Failure Rate</strong> - Requires CI/CD event tracking</li>
            <li><strong>Mean Time to Recovery</strong> - Requires incident tracking data</li>
          </ul>

          <p style="margin-top: 1rem; color: #666; font-size: 0.9rem;">
            Run <code>./run_pipeline.sh</code> locally to generate test coverage reports and CI artifacts.
          </p>
        </div>
      </section>

      <!-- Technical Details -->
      <section class="section">
        <h2>Technical Details</h2>
        <div class="technical-details">
          <h3>Data Pipeline</h3>
          <p><code>ReposInput.md</code> → <code>git_artifacts/</code> + <code>ci_artifacts/</code> → <code>calculations/</code> → This Report</p>

          <h3>Validation</h3>
              <p>All data validated against quality gates and stored in <a href="../calculations/manifest.json">manifest.json</a></p>

          <h3>Metrics Definition</h3>
          <ul style="margin-left: 1rem;">
            <li><strong>Activity Velocity:</strong> Total commits divided by unique dates in history</li>
            <li><strong>Lead Time:</strong> Average hours between consecutive commits</li>
            <li><strong>Deployment Frequency:</strong> Commits per calendar day (proxy for deployment frequency)</li>
          </ul>

          <h3>Raw Data Access</h3>
          <p>View detailed calculations: <a href="./calculations/">calculations/ folder</a></p>
          <p>View raw artifacts: <a href="./git_artifacts/">git_artifacts/</a> and <a href="./ci_artifacts/">ci_artifacts/</a></p>
        </div>
      </section>

    </main>

    <!-- Footer -->
    <footer class="report-footer">
      <p>R&D Metrics Report | Validated Analysis from Evidence-Backed Data</p>
      <p style="font-size: 0.85rem;">Generated from calculations/ folder • <a href="./calculations/MANIFEST.json">View validation manifest</a></p>
    </footer>
  </div>

  <script src="report.js"></script>
</body>
</html>
